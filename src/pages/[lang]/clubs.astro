---
import BaseLayout from "@layout/BaseLayout.astro";
import { getTranslation } from "@utils/i18n";
import {
  clubs,
  getColorValue,
  getCategories,
  getClubsByCategory,
  type ColorKey,
} from "../../data/clubs";

// Static paths for language routes
export function getStaticPaths() {
  return [{ params: { lang: "ko" } }, { params: { lang: "en" } }];
}

// URL 파라미터에서 언어 추출
const { lang } = Astro.params;
const currentLang: "ko" | "en" = lang === "ko" || lang === "en" ? lang : "ko";

// Get all categories
const categories = getCategories();

// Category translations
const categoryTranslations: Record<string, { ko: string; en: string }> = {
  Sports: { ko: "스포츠", en: "Sports" },
  Business: { ko: "비즈니스", en: "Business" },
  Music: { ko: "음악", en: "Music" },
  Academic: { ko: "학술", en: "Academic" },
  Service: { ko: "봉사", en: "Service" },
  Creative: { ko: "창작", en: "Creative" },
};
---

<BaseLayout
  lang={currentLang}
  title={getTranslation("clubs.title", currentLang)}
>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-teal-50 to-blue-50 py-20">
    <div class="pt-header container mx-auto px-4">
      <div class="text-center">
        <h1 class="mb-4 text-4xl font-bold text-gray-800 md:text-6xl">
          {getTranslation("clubs.title", currentLang)}
        </h1>
        <p class="mb-8 text-xl text-gray-600">
          {getTranslation("clubs.subtitle", currentLang)}
        </p>
      </div>
    </div>
  </section>

  <!-- Active Clubs Section -->
  <section class="bg-white py-20">
    <div class="container mx-auto px-4">
      <div class="mb-12 text-center">
        <h2 class="mb-4 text-3xl font-bold text-gray-800">
          {currentLang === "ko" ? "활동 중인 동아리" : "Active Clubs"}
        </h2>
        <p class="text-lg text-gray-600">
          {
            currentLang === "ko"
              ? "현재 HKUST KSA에서 활동하고 있는 동아리들을 소개합니다."
              : "Introducing the clubs currently active at HKUST KSA."
          }
        </p>
      </div>

      <!-- Category Filter Buttons -->
      <div class="mb-12 flex flex-wrap justify-center gap-2">
        <button
          class="filter-btn active rounded-full bg-teal-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-all duration-300 hover:bg-teal-700"
          data-category="all"
        >
          {currentLang === "ko" ? "전체" : "All"}
        </button>
        {
          categories.map((category) => (
            <button
              class="filter-btn rounded-full bg-gray-200 px-4 py-2 text-sm font-semibold text-gray-700 transition-all duration-300 hover:bg-gray-300"
              data-category={category}
            >
              {categoryTranslations[category][currentLang]}
            </button>
          ))
        }
      </div>

      <!-- All Clubs View (uncategorized) -->
      <div
        id="all-clubs-view"
        class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3"
      >
        {
          clubs.map((club) => (
            <a
              href={`/${currentLang}/clubs/${club.key}`}
              class="club-card group"
              data-category={club.category}
            >
              <div class="flex h-full min-h-[350px] flex-col rounded-xl border border-gray-100 bg-white px-6 pt-6 pb-1 shadow-lg transition-all duration-300 group-hover:-translate-y-1 hover:shadow-xl">
                <div class="mb-4 text-center">
                  {club.logo ? (
                    <div class="mx-auto mb-4 flex h-32 w-32 items-center justify-center transition-transform group-hover:scale-105">
                      <img
                        src={club.logo}
                        alt={`${currentLang === "ko" ? club.nameKo : club.nameEn} logo`}
                        class="h-full w-full object-contain"
                      />
                    </div>
                  ) : (
                    <div
                      class="mx-auto mb-4 flex h-32 w-32 items-center justify-center rounded-full transition-transform group-hover:scale-110"
                      style={`background-color: ${getColorValue(club.bgColor as ColorKey)}`}
                    >
                      <span class="text-4xl text-white">{club.emoji}</span>
                    </div>
                  )}
                  <h3 class="mb-2 text-xl font-semibold text-gray-800 transition-colors group-hover:text-teal-600">
                    {currentLang === "ko" ? club.nameKo : club.nameEn}
                  </h3>
                  <p class="mb-4 text-sm text-gray-600">
                    {currentLang === "ko" ? club.subtitleKo : club.subtitleEn}
                  </p>
                </div>
                <div class="mt-0.5 space-y-0.5">
                  <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">
                      {currentLang === "ko" ? "회장" : "President"}
                    </span>
                    <span class="text-sm text-gray-600">
                      {club.president || "-"}
                    </span>
                  </div>
                  <div class="border-t border-gray-100 pt-1">
                    <span class="text-xs text-gray-500 transition-colors group-hover:text-teal-500">
                      {currentLang === "ko" ? "자세히 보기 →" : "Learn more →"}
                    </span>
                  </div>
                </div>
              </div>
            </a>
          ))
        }
      </div>

      <!-- Clubs by Category -->
      <div id="categorized-clubs-view" style="display: none;">
        {
          categories.map((category) => {
            const clubsInCategory = getClubsByCategory(category);
            return (
              <div class="category-section mb-16" data-category={category}>
                <h3 class="mb-8 text-2xl font-bold text-gray-800">
                  {categoryTranslations[category][currentLang]}
                </h3>
                <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
                  {clubsInCategory.map((club) => (
                    <a
                      href={`/${currentLang}/clubs/${club.key}`}
                      class="club-card group"
                      data-category={club.category}
                    >
                      <div class="flex h-full min-h-[350px] flex-col rounded-xl border border-gray-100 bg-white px-6 pt-6 pb-1 shadow-lg transition-all duration-300 group-hover:-translate-y-1 hover:shadow-xl">
                        <div class="mb-4 text-center">
                          {club.logo ? (
                            <div class="mx-auto mb-4 flex h-32 w-32 items-center justify-center transition-transform group-hover:scale-105">
                              <img
                                src={club.logo}
                                alt={`${currentLang === "ko" ? club.nameKo : club.nameEn} logo`}
                                class="h-full w-full object-contain"
                              />
                            </div>
                          ) : (
                            <div
                              class="mx-auto mb-4 flex h-32 w-32 items-center justify-center rounded-full transition-transform group-hover:scale-110"
                              style={`background-color: ${getColorValue(club.bgColor as ColorKey)}`}
                            >
                              <span class="text-4xl text-white">
                                {club.emoji}
                              </span>
                            </div>
                          )}
                          <h3 class="mb-2 text-xl font-semibold text-gray-800 transition-colors group-hover:text-teal-600">
                            {currentLang === "ko" ? club.nameKo : club.nameEn}
                          </h3>
                          <p class="mb-4 text-sm text-gray-600">
                            {currentLang === "ko"
                              ? club.subtitleKo
                              : club.subtitleEn}
                          </p>
                        </div>
                        <div class="mt-0.5 space-y-0.5">
                          <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-700">
                              {currentLang === "ko" ? "회장" : "President"}
                            </span>
                            <span class="text-sm text-gray-600">
                              {club.president || "-"}
                            </span>
                          </div>
                          <div class="border-t border-gray-100 pt-1">
                            <span class="text-xs text-gray-500 transition-colors group-hover:text-teal-500">
                              {currentLang === "ko"
                                ? "자세히 보기 →"
                                : "Learn more →"}
                            </span>
                          </div>
                        </div>
                      </div>
                    </a>
                  ))}
                </div>
              </div>
            );
          })
        }
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <!-- <section class="py-20 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="text-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">
          {currentLang === 'ko' ? '동아리 가입 문의' : 'Join a Club'}
        </h2>
        <p class="text-lg text-gray-600 mb-8">
          {currentLang === 'ko' 
            ? '동아리에 가입하고 싶거나 추가 정보가 필요하시면 연락해 주세요.' 
            : 'Contact us if you want to join a club or need more information.'}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href={`/${currentLang}/contact`} class="bg-teal-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-teal-700 transition-colors">
            {getTranslation('contact.contact.button', currentLang)}
          </a>
          <a href={`/${currentLang}/events`} class="border-2 border-teal-600 text-teal-600 px-8 py-3 rounded-lg font-semibold hover:bg-teal-600 hover:text-white transition-colors">
            {currentLang === 'ko' ? '행사 보기' : 'View Events'}
          </a>
        </div>
      </div>
    </div>
  </section> -->

  <script>
    const filterButtons = document.querySelectorAll(".filter-btn");
    const allClubsView = document.getElementById("all-clubs-view");
    const categorizedClubsView = document.getElementById(
      "categorized-clubs-view",
    );
    const categorySections = document.querySelectorAll(".category-section");

    filterButtons.forEach((button) => {
      button.addEventListener("click", (e) => {
        const target = e.target as HTMLButtonElement;
        const selectedCategory = target.dataset.category;

        // Update active button style
        filterButtons.forEach((btn) => {
          btn.classList.remove(
            "active",
            "bg-teal-600",
            "text-white",
            "shadow-sm",
          );
          btn.classList.add("bg-gray-200", "text-gray-700");
        });
        target.classList.add(
          "active",
          "bg-teal-600",
          "text-white",
          "shadow-sm",
        );
        target.classList.remove("bg-gray-200", "text-gray-700");

        if (selectedCategory === "all") {
          // Show all clubs view (uncategorized)
          if (allClubsView) allClubsView.style.display = "grid";
          if (categorizedClubsView) categorizedClubsView.style.display = "none";
        } else {
          // Show categorized view and filter by category
          if (allClubsView) allClubsView.style.display = "none";
          if (categorizedClubsView)
            categorizedClubsView.style.display = "block";

          categorySections.forEach((section) => {
            const sectionElement = section as HTMLElement;
            if (sectionElement.dataset.category === selectedCategory) {
              sectionElement.style.display = "block";
            } else {
              sectionElement.style.display = "none";
            }
          });
        }
      });
    });
  </script>
</BaseLayout>
