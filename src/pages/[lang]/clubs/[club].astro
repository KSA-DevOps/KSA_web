---
import BaseLayout from "@layout/BaseLayout.astro";
import { getTranslation } from "@utils/i18n";
import { clubs, getColorValue, type ColorKey } from "../../../data/clubs";

// Static paths for language and club routes
export function getStaticPaths() {
  const paths = [];
  const languages = ["ko", "en"];

  for (const lang of languages) {
    for (const club of clubs) {
      paths.push({
        params: {
          lang: lang,
          club: club.key,
        },
        props: { club },
      });
    }
  }

  return paths;
}

// URL 파라미터에서 언어와 클럽 정보 추출
const { lang, club: clubKey } = Astro.params;
const { club } = Astro.props;
const currentLang: "ko" | "en" = lang === "ko" || lang === "en" ? lang : "ko";

// 404 처리
if (!club) {
  return Astro.redirect("/404");
}
---

<BaseLayout
  lang={currentLang}
  title={`${currentLang === "ko" ? club.nameKo : club.nameEn} - ${getTranslation("clubs.title", currentLang)}`}
>
  <!-- Breadcrumb -->
  <section class="bg-gray-50 py-4">
    <div class="container mx-auto px-4">
      <nav class="text-sm text-gray-600">
        <a href={`/${currentLang}`} class="hover:text-teal-600"
          >{getTranslation("nav.home", currentLang)}</a
        >
        <span class="mx-2">></span>
        <a href={`/${currentLang}/clubs`} class="hover:text-teal-600"
          >{getTranslation("nav.clubs", currentLang)}</a
        >
        <span class="mx-2">></span>
        <span class="text-gray-800"
          >{currentLang === "ko" ? club.nameKo : club.nameEn}</span
        >
      </nav>
    </div>
  </section>

  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-teal-50 to-blue-50 py-20">
    <div class="pt-header container mx-auto px-4">
      <div class="text-center">
        {
          club.logo ? (
            <div class="mx-auto mb-6 flex h-56 w-56 items-center justify-center">
              <img
                src={club.logo}
                alt={`${currentLang === "ko" ? club.nameKo : club.nameEn} logo`}
                class="h-full w-full object-contain"
              />
            </div>
          ) : (
            <div
              class="mx-auto mb-6 flex h-24 w-24 items-center justify-center rounded-full"
              style={`background-color: ${getColorValue(club.bgColor as ColorKey)}`}
            >
              <span class="text-4xl text-white">{club.emoji}</span>
            </div>
          )
        }
        <h1 class="mb-4 text-4xl font-bold text-gray-800 md:text-6xl">
          {currentLang === "ko" ? club.nameKo : club.nameEn}
        </h1>
        <p class="mb-8 text-xl text-gray-600">
          {currentLang === "ko" ? club.subtitleKo : club.subtitleEn}
        </p>
      </div>
    </div>
  </section>

  <!-- Club Information -->
  <section class="bg-white py-12">
    <div class="container mx-auto px-4">
      <div class="mx-auto max-w-4xl">
        <!-- Description -->
        <div class="mb-4">
          <h2 class="mb-4 text-3xl font-bold text-gray-800">
            {
              currentLang === "ko"
                ? club.key === "kriss"
                  ? "학회 소개"
                  : "동아리 소개"
                : "About the Club"
            }
          </h2>
          <p class="text-lg leading-relaxed whitespace-pre-line text-gray-600">
            {
              currentLang === "ko"
                ? club.descriptionKo ||
                  `${club.nameKo}는 ${club.subtitleKo} 활동을 하는 동아리입니다.`
                : club.descriptionEn ||
                  `${club.nameEn} is a club focused on ${club.subtitleEn.toLowerCase()} activities.`
            }
          </p>
        </div>

        <!-- Leadership Information -->
        <div class="mb-8">
          <div class="mx-auto max-w-4xl">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
              <!-- President -->
              <div
                class={`rounded-lg bg-white p-6 shadow-sm ${!club.vicePresident ? "md:col-span-2 md:w-1/2 md:mx-auto" : ""}`}
              >
                <div
                  class="flex h-full items-center justify-center text-center"
                >
                  <div>
                    <h4 class="mb-2 text-lg font-semibold text-gray-800">
                      {
                        currentLang === "ko"
                          ? club.key === "kriss"
                            ? "학회장"
                            : "부장"
                          : "President"
                      }
                    </h4>
                    <p class="text-base text-gray-600">
                      {
                        Array.isArray(club.president)
                          ? club.president.join(", ")
                          : club.president || "-"
                      }
                    </p>
                  </div>
                </div>
              </div>

              <!-- Vice President -->
              {
                club.vicePresident && (
                  <div class="rounded-lg bg-white p-6 shadow-sm">
                    <div class="flex h-full items-center justify-center text-center">
                      <div>
                        <h4 class="mb-2 text-lg font-semibold text-gray-800">
                          {currentLang === "ko" ? "차장" : "Vice President"}
                        </h4>
                        <p class="text-base text-gray-600">
                          {Array.isArray(club.vicePresident)
                            ? club.vicePresident.join(", ")
                            : club.vicePresident}
                        </p>
                      </div>
                    </div>
                  </div>
                )
              }
            </div>
          </div>
        </div>

        <!-- Instagram Link -->
        {
          club.link && (
            <div class="text-center">
              <a
                href={club.link}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center justify-center rounded-lg bg-teal-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-teal-700"
              >
                <span class="mr-2">📷</span>
                {currentLang === "ko" ? "인스타그램 보기" : "View Instagram"}
              </a>
            </div>
          )
        }

        <!-- Back to Clubs -->
        <div class="mt-12 text-center">
          <a
            href={`/${currentLang}/clubs`}
            class="inline-flex items-center font-semibold text-teal-600 hover:text-teal-800"
          >
            <span class="mr-2">←</span>
            {currentLang === "ko" ? "모든 동아리 보기" : "View All Clubs"}
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
